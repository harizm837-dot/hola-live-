<!DOCTYPE html>
<html lang="mn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>HOLA LIVE | Master Hub</title>
    
    <link rel="stylesheet" href="assets/css/global.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="css/variables.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg: #05070f; --nav-h: 80px; --accent: #00f2ff; }
        body { margin: 0; background: var(--bg); color: #fff; height: 100vh; overflow: hidden; display: flex; flex-direction: column; font-family: 'Inter', sans-serif; }

        /* HEADER */
        header { 
            padding: calc(15px + env(safe-area-inset-top)) 20px 15px 20px;
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(13, 18, 36, 0.9); backdrop-filter: blur(20px); z-index: 1000;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .brand { font-weight: 900; font-size: 22px; color: var(--accent); letter-spacing: -1px; }
        .stats { display: flex; gap: 10px; }
        .stat-badge { background: rgba(255,255,255,0.05); padding: 6px 15px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.1); font-size: 13px; font-weight: 800; }

        /* IFRAME CONTAINER */
        #main-viewport { flex: 1; position: relative; width: 100%; overflow: hidden; }
        #app-frame { width: 100%; height: 100%; border: none; transition: 0.3s; }

        /* NAVIGATION - 6 “Æ–Ω–¥—Å—ç–Ω —Ü—ç—Å */
        nav { 
            height: var(--nav-h); background: #0d1224; display: flex; 
            padding-bottom: env(safe-area-inset-bottom); border-top: 1px solid rgba(255,255,255,0.1);
            z-index: 1000;
        }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; color: #555; cursor: pointer; transition: 0.3s; }
        .nav-item.active { color: var(--accent); }
        .nav-item span { font-size: 22px; }
        .nav-item label { font-size: 9px; font-weight: 900; text-transform: uppercase; }

        /* Notification Toast */
        #alert-box { position: fixed; top: 100px; left: 50%; transform: translateX(-50%); background: var(--accent); color: #000; padding: 10px 25px; border-radius: 50px; font-weight: 900; z-index: 2000; display: none; }
    </style>
</head>
<body>

    <header>
        <div class="brand">HOLA</div>
        <div class="stats">
            <div class="stat-badge" style="color:var(--accent)">‚≠ê <span id="top-lvl">1</span></div>
            <div class="stat-badge" style="color:#ffcf40" onclick="loadPage('pages/store.html')">üíé <span id="top-wallet">0</span></div>
        </div>
    </header>

    <div id="alert-box">–ú—ç–¥—ç–≥–¥—ç–ª</div>

    <div id="main-viewport">
        <iframe id="app-frame" src="pages/home.html"></iframe>
    </div>

    <nav>
        <div class="nav-item active" onclick="navTo('pages/home.html', this)">
            <span>üè†</span><label>Home</label>
        </div>
        <div class="nav-item" onclick="navTo('pages/live.html', this)">
            <span>üì∫</span><label>Live</label>
        </div>
        <div class="nav-item" onclick="navTo('pages/leaderboard.html', this)">
            <span>üèÜ</span><label>Ranks</label>
        </div>
        <div class="nav-item" onclick="navTo('pages/store.html', this)">
            <span>üõí</span><label>Store</label>
        </div>
        <div class="nav-item" onclick="navTo('pages/vip.html', this)">
            <span>üëë</span><label>VIP</label>
        </div>
        <div class="nav-item" onclick="navTo('pages/profile.html', this)">
            <span>üë§</span><label>Profile</label>
        </div>
    </nav>

    <script src="js/eventBus.js"></script> <script src="js/economyEngine.js"></script>
    <script src="js/adminEngine.js"></script>
    <script src="js/levelEngine.js"></script>
    <script src="js/growthEngine.js"></script>
    <script src="js/battleEngine.js"></script>
    <script src="js/uiEnhance.js"></script>

    <script>
        const frame = document.getElementById('app-frame');

        // –•—É—É–¥–∞—Å —Å–æ–ª–∏—Ö
        function navTo(url, el) {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            loadPage(url);
        }

        function loadPage(url) {
            frame.style.opacity = '0';
            setTimeout(() => {
                frame.src = url;
                frame.style.opacity = '1';
            }, 150);
        }

        // –î–∞—Ç–∞ —à–∏–Ω—ç—á–ª—ç—Ö (Global Sync)
        function syncUI() {
            const wallet = localStorage.getItem('hola_wallet') || 0;
            const stats = JSON.parse(localStorage.getItem('hola_user_stats')) || { level: 1 };
            
            document.getElementById('top-wallet').innerText = parseInt(wallet).toLocaleString();
            document.getElementById('top-lvl').innerText = stats.level;
        }

        // EVENT BRIDGE: Moderator -> Live —ç—Å–≤—ç–ª BattleEngine -> UI
        window.addEventListener('message', (e) => {
            const data = e.data;
            
            // 1. –°—Ç—Ä–∏–º–∏–Ω–≥ –∫–æ–º–∞–Ω–¥ –¥–∞–º–∂—É—É–ª–∞—Ö
            if(['DIAMOND_RAIN', 'START_PK', 'SPAWN_SECRET'].includes(data.type)) {
                if(frame.src.includes('live.html')) {
                    frame.contentWindow.postMessage(data, '*');
                }
            }

            // 2. –°–∏—Å—Ç–µ–º–∏–π–Ω –º—ç–¥—ç–≥–¥—ç–ª
            if(data.type === 'WALLET_UPDATED' || data.type === 'LEVEL_UP') {
                syncUI();
            }
        });

        // 1 —Å–µ–∫—É–Ω–¥ —Ç—É—Ç–∞–º–¥ —Å–∏–Ω—Ö—Ä–æ–Ω —Ö–∏–π–Ω—ç
        setInterval(syncUI, 1000);
        syncUI();
    </script>
</body>
</html>
