<!DOCTYPE html>
<html lang="mn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#05070f">
    <title>HOLA LIVE | Master Hub Engine</title>
    
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="assets/css/global.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* FALLBACK & SHELL STYLES (–•—ç—Ä—ç–≤ variables.css —É–Ω—à–∏—Ö–≥“Ø–π –±–æ–ª —Ö–∞–º–≥–∞–∞–ª–∞—Ö) */
        :root { 
            --hub-bg: #05070f; 
            --hub-nav: rgba(13, 18, 36, 0.95); 
            --hub-accent: #00f2ff; 
            --hub-gold: #ffcf40;
            --hub-danger: #ff0055;
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; margin: 0; padding: 0; }

        body { 
            font-family: 'Inter', sans-serif; background: var(--hub-bg); color: #fff; 
            height: 100vh; width: 100vw; overflow: hidden; display: flex; flex-direction: column; 
        }

        /* --- GLOBAL HEADER (“Æ—Ä–≥—ç–ª–∂ —Ö–∞—Ä–∞–≥–¥–∞–Ω–∞) --- */
        header { 
            padding: calc(15px + var(--safe-top)) 20px 15px 20px;
            display: flex; justify-content: space-between; align-items: center;
            background: var(--hub-nav); backdrop-filter: blur(20px); z-index: 9999;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 4px 30px rgba(0,0,0,0.5);
        }

        .brand-logo { font-weight: 900; font-size: 24px; color: var(--hub-accent); letter-spacing: -1.5px; text-transform: uppercase; text-shadow: 0 0 10px rgba(0, 242, 255, 0.3); cursor: pointer; }
        
        .global-stats { display: flex; gap: 8px; }
        .stat-pill { 
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            padding: 6px 14px; border-radius: 30px; font-size: 13px; font-weight: 800;
            display: flex; align-items: center; gap: 6px; transition: all 0.2s ease; cursor: pointer;
        }
        .stat-pill:active { transform: scale(0.95); background: rgba(255,255,255,0.1); }
        #global-level-val { color: var(--hub-accent); }
        #global-wallet-val { color: var(--hub-gold); }

        /* --- DYNAMIC VIEWPORT (Iframe Container) --- */
        #hub-viewport { flex: 1; position: relative; width: 100%; overflow: hidden; background: #000; }
        
        #app-frame { 
            width: 100%; height: 100%; border: none; position: absolute; top: 0; left: 0;
            transition: opacity 0.25s ease, transform 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: var(--hub-bg);
        }

        /* --- LOADING SPINNER --- */
        #loader {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.1);
            border-top-color: var(--hub-accent); border-radius: 50%;
            animation: spin 1s linear infinite; display: none; z-index: 10;
        }
        @keyframes spin { to { transform: translate(-50%, -50%) rotate(360deg); } }

        /* --- BOTTOM NAVIGATION --- */
        nav { 
            height: calc(75px + var(--safe-bottom)); background: var(--hub-nav); display: flex; 
            align-items: center; justify-content: space-around;
            border-top: 1px solid rgba(255,255,255,0.08); padding-bottom: var(--safe-bottom);
            z-index: 9999; position: relative;
        }

        .nav-item { 
            display: flex; flex-direction: column; align-items: center; gap: 5px;
            color: #5a6582; cursor: pointer; transition: 0.3s; flex: 1; position: relative;
        }
        .nav-item.active { color: var(--hub-accent); }
        .nav-item.active::before {
            content: ''; position: absolute; top: -12px; width: 25px; height: 4px;
            background: var(--hub-accent); border-radius: 0 0 5px 5px; box-shadow: 0 2px 10px var(--hub-accent);
        }
        .nav-item span { font-size: 22px; transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .nav-item:active span { transform: scale(1.3); }
        .nav-item label { font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; }

        /* --- FLOATING ACTION MENU (–û–ª–æ–Ω —Ö—É—É–¥—Å—ã–≥ –±–∞–≥—Ç–∞–∞—Ö —Ü—ç—Å) --- */
        #more-menu {
            position: absolute; bottom: calc(85px + var(--safe-bottom)); right: 15px;
            background: rgba(20, 25, 45, 0.95); backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 15px;
            padding: 10px; display: flex; flex-direction: column; gap: 5px;
            transform: scale(0); transform-origin: bottom right; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 9998; box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        #more-menu.open { transform: scale(1); }
        .menu-btn { padding: 12px 20px; color: #fff; font-size: 13px; font-weight: 700; border-radius: 10px; cursor: pointer; display: flex; gap: 10px; align-items: center; }
        .menu-btn:active { background: rgba(255,255,255,0.1); }
        .menu-btn.danger { color: var(--hub-danger); }

        /* --- SYSTEM TOAST NOTIFICATION --- */
        #system-alert {
            position: fixed; top: calc(80px + var(--safe-top)); left: 50%; transform: translateX(-50%);
            background: var(--hub-accent); color: #000; padding: 12px 25px; border-radius: 50px;
            font-weight: 900; font-size: 13px; z-index: 10000; display: none; box-shadow: 0 10px 30px rgba(0, 242, 255, 0.3);
            animation: slideDown 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes slideDown { from { transform: translate(-50%, -30px); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }
    </style>
</head>
<body>

    <header>
        <div class="brand-logo" onclick="switchPage('pages/home.html')">HOLA</div>
        <div class="global-stats">
            <div class="stat-pill" onclick="switchPage('pages/profile.html')">
                ‚≠ê <span id="global-level-val">1</span>
            </div>
            <div class="stat-pill" onclick="switchPage('pages/store.html')">
                üíé <span id="global-wallet-val">0</span>
            </div>
        </div>
    </header>

    <div id="system-alert">–°–∏—Å—Ç–µ–º–∏–π–Ω –º—ç–¥—ç—ç–ª—ç–ª</div>

    <div id="hub-viewport">
        <div id="loader"></div>
        <iframe id="app-frame" src="pages/home.html" allow="autoplay; camera; microphone; fullscreen"></iframe>
    </div>

    <div id="more-menu">
        <div class="menu-btn" onclick="switchPage('pages/invite.html'); toggleMenu()">üéÅ –£—Ä–∏—Ö (Invite)</div>
        <div class="menu-btn" onclick="switchPage('pages/vip.html'); toggleMenu()">üëë VIP –≠—Ä—Ö</div>
        <div class="menu-btn" onclick="switchPage('pages/streamer.html'); toggleMenu()">üé• –°—Ç—Ä–∏–º–µ—Ä –±–æ–ª–æ—Ö</div>
        <div class="menu-btn danger" onclick="switchPage('pages/moderator.html'); toggleMenu()">üõ°Ô∏è –ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª</div>
    </div>

    <nav>
        <div class="nav-item active" onclick="navClick(this, 'pages/home.html')">
            <span>üè†</span><label>Home</label>
        </div>
        <div class="nav-item" onclick="navClick(this, 'pages/live.html')">
            <span>üì∫</span><label>Live</label>
        </div>
        <div class="nav-item" onclick="navClick(this, 'pages/leaderboard.html')">
            <span>üèÜ</span><label>Rank</label>
        </div>
        <div class="nav-item" onclick="navClick(this, 'pages/store.html')">
            <span>üõí</span><label>Store</label>
        </div>
        <div class="nav-item" onclick="navClick(this, 'pages/profile.html')">
            <span>üë§</span><label>Me</label>
        </div>
        <div class="nav-item" onclick="toggleMenu()">
            <span>‚öôÔ∏è</span><label>More</label>
        </div>
    </nav>

    <script src="js/eventBus.js"></script> 
    <script src="js/economyEngine.js"></script>
    <script src="js/adminEngine.js"></script>
    <script src="js/levelEngine.js"></script>
    <script src="js/battleEngine.js"></script>
    <script src="js/growthEngine.js"></script>
    <script src="js/uiEnhance.js"></script>
    <script src="assets/js/engine.js"></script>
    <script src="components/MiniGame.js"></script>

    <script>
        const frame = document.getElementById('app-frame');
        const loader = document.getElementById('loader');
        const alertBox = document.getElementById('system-alert');
        const menu = document.getElementById('more-menu');

        let currentUrl = 'pages/home.html';

        // --- A. NAVIGATION LOGIC ---
        function navClick(element, url) {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            element.classList.add('active');
            menu.classList.remove('open'); // Close menu if open
            switchPage(url);
        }

        function toggleMenu() {
            menu.classList.toggle('open');
        }

        function switchPage(url) {
            if(currentUrl === url) return; // –ò–∂–∏–ª —Ö—É—É–¥–∞—Å —Ä—É—É –¥–∞—Ö–∏–Ω —É–Ω—à–∏—Ö–≥“Ø–π
            
            currentUrl = url;
            frame.style.opacity = '0';
            frame.style.transform = 'scale(0.97)';
            loader.style.display = 'block';

            setTimeout(() => {
                frame.src = url;
            }, 200);
        }

        // Iframe –∞—á–∞–∞–ª–∂ –¥—É—É—Å–∞—Ö “Ø–µ–¥
        frame.onload = function() {
            loader.style.display = 'none';
            frame.style.opacity = '1';
            frame.style.transform = 'scale(1)';
        };

        // --- B. GLOBAL DATA SYNC ---
        function syncGlobalData() {
            try {
                // Economy Engine —Ö–æ–ª–±–æ–≥–¥—Å–æ–Ω “Ø–µ–¥ —à—É—É–¥ –∞—à–∏–≥–ª–∞—Ö, —ç—Å–≤—ç–ª localStorage —à–∞–ª–≥–∞—Ö
                const wallet = localStorage.getItem('hola_wallet') || 0;
                const stats = JSON.parse(localStorage.getItem('hola_user_stats')) || { level: 1 };
                
                document.getElementById('global-wallet-val').innerText = parseInt(wallet).toLocaleString();
                document.getElementById('global-level-val').innerText = stats.level;
            } catch (e) {
                console.warn("Sync error:", e);
            }
        }

        // --- C. THE EVENT BUS BRIDGE (–•–∞–º–≥–∏–π–Ω —á—É—Ö–∞–ª —Ö—ç—Å—ç–≥) ---
        // Iframe-“Ø“Ø–¥ —Ö–æ–æ—Ä–æ–Ω–¥–æ–æ —à—É—É–¥ —Ö–∞—Ä—å—Ü–∞–∂ —á–∞–¥–∞—Ö–≥“Ø–π —Ç—É–ª app.html –¥—É–Ω–¥—É—É—Ä –Ω—å –≥“Ø“Ø—Ä –±–æ–ª–Ω–æ.
        window.addEventListener('message', (event) => {
            const data = event.data;
            if(!data || !data.type) return;

            console.log("üü¢ [HUB RECEIVER] Message:", data.type);

            // 1. Moderator-–∞–∞—Å Live —Ä—É—É –¥–∞–º–∂—É—É–ª–∞—Ö –∫–æ–º–∞–Ω–¥—É—É–¥
            const liveCommands = ['DIAMOND_RAIN', 'SPAWN_SECRET', 'START_PK', 'SYSTEM_ALERT', 'KICK_USER'];
            if(liveCommands.includes(data.type)) {
                // –•—ç—Ä—ç–≤ —Ö—ç—Ä—ç–≥–ª—ç–≥—á —è–≥ –æ–¥–æ–æ Live —Ö—É—É–¥—Å–∞–Ω–¥ –±–∞–π–≥–∞–∞ –±–æ–ª –º–µ—Å—Å–µ–∂–∏–π–≥ –¥–æ—Ç–æ–≥—à –Ω—å —à–∏–¥–Ω—ç
                if(frame.src.includes('live.html')) {
                    frame.contentWindow.postMessage(data, '*');
                    showToast("–ö–æ–º–∞–Ω–¥ –ª–∞–π–≤ —Ä—É—É –∏–ª–≥—ç—ç–≥–¥–ª—ç—ç!");
                } else {
                    showToast("–ê–Ω—Ö–∞–∞—Ä—É—É–ª–≥–∞: –≠–Ω—ç –∫–æ–º–∞–Ω–¥ –∑”©–≤—Ö”©–Ω Live ”©—Ä”©”©–Ω–¥ –∞–∂–∏–ª–ª–∞–Ω–∞.", true);
                }
            }

            // 2. –•—É—É–¥–∞—Å –¥–æ—Ç—Ä–æ–æ—Å (–∂–∏—à—ç—ç –Ω—å Store) —Ö—É–¥–∞–ª–¥–∞–Ω –∞–≤–∞–ª—Ç —Ö–∏–π—Ö—ç–¥ –¥—ç—ç–¥ UI —à–∏–Ω—ç—á–ª—ç–≥–¥—ç—Ö
            if(data.type === 'WALLET_UPDATED' || data.type === 'LEVEL_UP') {
                syncGlobalData();
            }

            // 3. Battle —ç—Å–≤—ç–ª Growth engine-—ç—ç—Å –∏—Ä—ç—Ö –≥–ª–æ–±–∞–ª –º—ç–¥—ç–≥–¥–ª“Ø“Ø–¥
            if(data.type === 'BATTLE_START') {
                showToast("‚öîÔ∏è –ê–ù–•–ê–ê–†! PK –¢—É–ª–∞–∞–Ω —ç—Ö—ç–ª–ª—ç—ç!");
            }
            if(data.type === 'VIP_PURCHASED') {
                showToast("üëë VIP —ç—Ä—Ö –∏–¥—ç–≤—Ö–∂–ª—ç—ç!");
                syncGlobalData();
            }
        });

        // --- D. UI HELPERS ---
        function showToast(msg, isWarning = false) {
            alertBox.innerText = msg;
            alertBox.style.background = isWarning ? 'var(--hub-danger)' : 'var(--hub-accent)';
            alertBox.style.color = isWarning ? '#fff' : '#000';
            alertBox.style.display = 'block';
            
            setTimeout(() => { 
                alertBox.style.display = 'none'; 
            }, 3000);
        }

        // Init
        setInterval(syncGlobalData, 1000); // UI-–≥ –±–∞–π–Ω–≥–∞ —à–∏–Ω—ç—á–ª—ç—Ö —Ö–∞–º–≥–∞–∞–ª–∞–ª—Ç
        syncGlobalData();

    </script>
</body>
</html>
