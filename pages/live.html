<!DOCTYPE html>
<html lang="mn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hola Live | Live Room</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Montserrat:wght@900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --accent: #7df9ff; --gold: #ffcf40; --danger: #ff0055; 
            --blue: #0055ff; --panel: rgba(13, 18, 36, 0.95); 
        }

        body { 
            margin: 0; font-family: 'Inter', sans-serif; background: #000; 
            color: #fff; height: 100vh; display: flex; overflow: hidden; 
        }

        /* --- STREAM AREA --- */
        .video-container { 
            flex: 1; position: relative; background: #05070f; 
            display: flex; align-items: center; justify-content: center; 
        }
        
        .live-stream-placeholder { 
            width: 100%; height: 100%; object-fit: cover; opacity: 0.7; 
        }

        /* --- PK BATTLE UI --- */
        .pk-wrapper {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            width: 85%; z-index: 100; display: none; /* PK —ç—Ö–ª—ç—Ö—ç–¥ —Ö–∞—Ä–∞–≥–¥–∞–Ω–∞ */
        }
        .pk-timer {
            text-align: center; font-family: 'Montserrat'; color: var(--gold);
            font-size: 14px; text-shadow: 0 0 10px rgba(0,0,0,0.5); margin-bottom: 5px;
        }
        .battle-bar {
            height: 28px; background: #222; border-radius: 14px; overflow: hidden;
            display: flex; border: 2px solid #fff; box-shadow: 0 0 20px rgba(0,0,0,0.5);
            position: relative;
        }
        .bar-left { 
            height: 100%; background: linear-gradient(90deg, var(--danger), #ff8800); 
            width: 50%; transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex; align-items: center; padding-left: 15px; font-weight: 900;
        }
        .bar-right { 
            flex: 1; background: linear-gradient(90deg, var(--blue), #00d4ff); 
            display: flex; align-items: center; justify-content: flex-end; 
            padding-right: 15px; font-weight: 900;
        }
        .vs-tag {
            position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
            background: #fff; color: #000; font-size: 10px; font-weight: 900;
            padding: 3px 8px; border-radius: 4px;
        }

        /* --- LUCKY BOX GAME --- */
        #luckyBox {
            position: absolute; font-size: 50px; cursor: pointer; z-index: 110;
            display: none; animation: boxJump 0.6s infinite alternate;
            filter: drop-shadow(0 0 15px var(--gold));
        }
        @keyframes boxJump { from { transform: scale(1); } to { transform: scale(1.2) translateY(-10px); } }

        /* --- CHAT & GIFTS --- */
        .sidebar { 
            width: 360px; background: var(--panel); border-left: 1px solid rgba(255,255,255,0.1);
            display: flex; flex-direction: column; 
        }
        .chat-area { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .message { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 12px; font-size: 13px; border-left: 3px solid var(--accent); }
        .message b { color: var(--accent); }

        .gift-grid { 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px;
            background: rgba(0,0,0,0.3); border-top: 1px solid rgba(255,255,255,0.05);
        }
        .gift-item { 
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px; padding: 12px 5px; text-align: center; cursor: pointer; transition: 0.2s;
        }
        .gift-item:hover { background: var(--accent); color: #000; transform: translateY(-3px); }
        .gift-item div:first-child { font-size: 24px; margin-bottom: 5px; }
        .gift-item div:last-child { font-size: 11px; font-weight: 700; opacity: 0.8; }

        /* Streamer Info */
        .streamer-header {
            position: absolute; top: 20px; left: 20px; display: flex; align-items: center; gap: 12px;
            background: rgba(0,0,0,0.5); padding: 8px 15px; border-radius: 50px; backdrop-filter: blur(10px);
        }
        .avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--accent); border: 2px solid #fff; }
    </style>
</head>
<body>

    <div class="video-container">
        <img src="https://picsum.photos/id/65/1200/800" class="live-stream-placeholder">
        
        <div class="pk-wrapper" id="pkUI">
            <div class="pk-timer" id="pkTimer">05:00</div>
            <div class="battle-bar">
                <div class="bar-left" id="barLeft">0</div>
                <div class="bar-right" id="barRight">0</div>
                <div class="vs-tag">VS</div>
            </div>
        </div>

        <div id="luckyBox" onclick="claimBox()">üéÅ</div>

        <div class="streamer-header">
            <div class="avatar"></div>
            <div>
                <div style="font-weight:900; font-size:14px;">Anu_B <span style="color:var(--gold)">üëë</span></div>
                <div style="font-size:10px; opacity:0.8;">üë§ 2,410 “Ø–∑—ç–≥—á–∏–¥</div>
            </div>
        </div>
    </div>

    <aside class="sidebar">
        <div class="chat-area" id="chat">
            <div class="message"><b>System:</b> Hola Live-–¥ —Ç–∞–≤—Ç–∞–π –º–æ—Ä–∏–ª! –°–æ—ë–ª—Ç–æ–π —Ö–∞—Ä—å—Ü–∞–Ω–∞ —É—É.</div>
        </div>

        <div class="gift-grid">
            <div class="gift-item" onclick="sendGift('Rose', 'üåπ', 10)">
                <div>üåπ</div><div>10</div>
            </div>
            <div class="gift-item" onclick="sendGift('Finger', 'ü´∞', 50)">
                <div>ü´∞</div><div>50</div>
            </div>
            <div class="gift-item" onclick="sendGift('Rocket', 'üöÄ', 500)">
                <div>üöÄ</div><div>500</div>
            </div>
            <div class="gift-item" onclick="sendGift('Car', 'üèéÔ∏è', 1000)">
                <div>üèéÔ∏è</div><div>1000</div>
            </div>
            <div class="gift-item" onclick="sendGift('Dragon', 'üêâ', 5000)">
                <div>üêâ</div><div>5000</div>
            </div>
            <div class="gift-item" onclick="sendGift('Crown', 'üëë', 9999)">
                <div>üëë</div><div>9999</div>
            </div>
        </div>
    </aside>

    <script src="../js/eventBus.js"></script>
    <script src="../js/economyEngine.js"></script>
    <script src="../js/growthEngine.js"></script>
    
    <script>
        // --- 1. PK BATTLE STATE ---
        let pkActive = false;
        let scores = { left: 0, right: 0 };

        // --- 2. –ë–≠–õ–≠–ì –ò–õ–ì–≠–≠–• ---
        function sendGift(name, icon, price) {
            const success = EconomyEngine.processGift({
                user: "–ù–∞–º–∞–π–≥", 
                streamer: "Anu_B", 
                giftName: name, 
                icon: icon, 
                price: price
            });

            if(success) {
                // XP –Ω—ç–º—ç—Ö
                GrowthEngine.addXP(Math.floor(price / 5));
                addChatMessage("–ë–∏", `${icon} ${name} –∏–ª–≥—ç—ç–ª—ç—ç!`);

                // –•—ç—Ä—ç–≤ PK –∏–¥—ç–≤—Ö—Ç—ç–π –±–æ–ª –æ–Ω–æ–æ –Ω—ç–º—ç—Ö
                if(pkActive) {
                    updatePKScore('left', price);
                }
            } else {
                alert("–¢–æ–∫–µ–Ω —Ö“Ø—Ä—ç–ª—Ü—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞! –î—ç–ª–≥“Ø“Ø—Ä—ç—ç—Å —Ü—ç–Ω—ç–≥–ª—ç–Ω—ç “Ø“Ø.");
            }
        }

        // --- 3. PK SCORE LOGIC ---
        function updatePKScore(side, amount) {
            scores[side] += amount;
            const total = scores.left + scores.right;
            const leftPercent = total === 0 ? 50 : (scores.left / total) * 100;

            document.getElementById('barLeft').style.width = leftPercent + '%';
            document.getElementById('barLeft').innerText = scores.left;
            document.getElementById('barRight').innerText = scores.right;
        }

        // --- 4. GLOBAL EVENTS (Lucky Box & PK Start) ---
        EventBus.listen((data) => {
            // Lucky Box –≥–∞—Ä—á –∏—Ä—ç—Ö
            if(data.type === 'SPAWN_BOX') {
                const box = document.getElementById('luckyBox');
                box.style.left = (20 + Math.random() * 60) + '%';
                box.style.top = (20 + Math.random() * 60) + '%';
                box.style.display = 'block';
            }

            // PK —ç—Ö–ª—ç—Ö –¥–æ—Ö–∏–æ (Streamer-—ç—ç—Å –∏—Ä–Ω—ç)
            if(data.type === 'BATTLE_STARTED') {
                pkActive = true;
                scores = { left: 0, right: 2500 }; // –≠—Å—Ä—ç–≥ —Ç–∞–ª 2500 –æ–Ω–æ–æ—Ç–æ–π —ç—Ö—ç–ª–ª—ç—ç –≥—ç–∂ –∂–∏—à—ç—ç –∞–≤—ä—è
                document.getElementById('pkUI').style.display = 'block';
                updatePKScore('left', 0);
            }
        });

        // --- 5. MINI GAME CLAIM ---
        function claimBox() {
            const prize = Math.floor(Math.random() * 100) + 10;
            EconomyEngine.updateWallet(prize);
            document.getElementById('luckyBox').style.display = 'none';
            addChatMessage("System", `üéÅ –ë–∞—è—Ä —Ö“Ø—Ä–≥—ç–µ! –ß–∏ —Ö–∞–π—Ä—Ü–∞–≥–Ω–∞–∞—Å ${prize}üíé —Ö–æ–∂–ª–æ–æ!`);
        }

        function addChatMessage(user, text) {
            const chat = document.getElementById('chat');
            const div = document.createElement('div');
            div.className = 'message';
            div.innerHTML = `<b>${user}:</b> ${text}`;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }
    </script>
</body>
</html>
